<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Genie - Personalized Gift Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #fff1f2, #fed7aa);
            min-height: 100vh;
            margin: 0;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .glow-card { box-shadow: 0 4px 20px -5px rgba(236, 72, 153, 0.15); transition: all 0.3s ease; }
        .glow-card:hover { box-shadow: 0 8px 30px -5px rgba(236, 72, 153, 0.25); transform: translateY(-2px); }
        .chat-bubble { position: relative; border-radius: 18px; padding: 15px; }
        .chat-bubble::after { content: ''; position: absolute; bottom: 0; width: 0; height: 0; border: 10px solid transparent; }
        .user-bubble::after { right: -10px; border-left-color: #ec4899; border-right: 0; border-bottom: 0; margin-bottom: 10px; }
        .assistant-bubble::after { left: -10px; border-right-color: #fef2f2; border-left: 0; border-bottom: 0; margin-bottom: 10px; }
        .custom-scrollbar { max-height: 500px; overflow-y: auto; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(254, 242, 242, 0.5); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(236, 72, 153, 0.5); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(219, 39, 119, 0.7); }
        .section-title { font-weight: 600; color: #9d174d; margin: 1rem 0 0.5rem 0; font-size: 1.2rem; display: flex; align-items: center; }
        .prebuilt-btn { background: #fff; border: 1px solid #fef2f2; padding: 10px; border-radius: 8px; transition: all 0.3s; }
        .prebuilt-btn:hover { background: #fef2f2; transform: translateY(-2px); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
        .saved-chat-item { padding: 10px; border-bottom: 1px solid #fef2f2; display: flex; justify-content: space-between; align-items: center; }
        .saved-chat-item:hover { background: #fff1f2; }
        .toolbar { display: flex; gap: 10px; justify-content: flex-end; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="text-center mb-6 bg-white rounded-2xl p-4 glow-card">
            <div class="flex justify-center items-center">
                <i class="fas fa-gift text-pink-500 text-3xl mr-3"></i>
                <h1 class="text-2xl font-bold text-pink-800">Gift Genie</h1>
            </div>
            <p class="text-base text-pink-600 mt-1">Discover thoughtful gifts with AI assistance</p>
        </header>

        <div class="bg-white rounded-2xl shadow-lg glow-card mb-6 p-6">
            <h3 class="text-lg font-semibold text-pink-800 mb-4"><i class="fas fa-lightbulb mr-2"></i>Quick Gift Ideas</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button class="prebuilt-btn" onclick="quickStart('Tech gifts for dad under ₹8000')">Tech gifts for dad under ₹8000</button>
                <button class="prebuilt-btn" onclick="quickStart('Birthday gift for a book-loving sister')">Birthday gift for a book-loving sister</button>
                <button class="prebuilt-btn" onclick="quickStart('Luxury anniversary gift for wife')">Luxury anniversary gift for wife</button>
                <button class="prebuilt-btn" onclick="quickStart('Thoughtful gifts for a best friend')">Thoughtful gifts for a best friend</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg glow-card">
            <div class="toolbar bg-gradient-to-r from-pink-600 to-orange-600 text-white rounded-t-2xl">
                <button id="clear-chat" class="text-white hover:text-gray-200"><i class="fas fa-trash"></i> Clear</button>
                <button id="save-chat" class="text-white hover:text-gray-200"><i class="fas fa-save"></i> Save</button>
                <button id="view-saved-chats" class="text-white hover:text-gray-200"><i class="fas fa-history"></i> Saved Ideas</button>
            </div>
            <div id="chat-container" class="custom-scrollbar p-4 bg-gradient-to-b from-rose-50 to-white"></div>
            <div class="p-4 border-t border-rose-100">
                <div class="flex gap-2">
                    <input type="text" id="user-input" 
                        class="flex-1 p-3 border-2 border-rose-200 rounded-lg focus:outline-none focus:border-rose-400" 
                        placeholder="Describe the recipient or occasion (e.g., 'Gifts for a book-loving sister, ₹4000 budget')">
                    <button id="send-message" class="bg-pink-500 text-white p-3 rounded-lg hover:bg-pink-600">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>

        <div id="saved-chats-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-pink-800">Saved Gift Ideas</h3>
                    <button id="close-modal" class="text-pink-600 hover:text-pink-800"><i class="fas fa-times"></i></button>
                </div>
                <div id="saved-chats-list"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        const API_KEY = 'AIzaSyBgtmjMT0kwSdA-aE4q6-ItHCeKQ5Tjb70';
        const SYSTEM_PROMPT = `You are Gift Genie, an AI gift recommendation assistant. Provide personalized gift suggestions based on the recipient, occasion, budget, and interests, with prices in Indian Rupees (INR) using the ₹ symbol. Structure responses with:
        Gift Overview: Summary of the gift ideas and why they suit the recipient
        Top Recommendations: 3-5 specific gifts with brief descriptions and estimated prices in INR
        Where to Buy: Suggest online or physical stores, preferring Indian retailers when possible
        Personalization Tips: Ideas to make the gift special
        Be creative, thoughtful, and concise. Use plain text headings and bullet points without asterisks, bold markers, or other markdown symbols. Emphasize gift names and prices in the Top Recommendations section by wrapping them in <strong> tags (e.g., <strong>Gift Name</strong>: ₹<strong>Price</strong>).`;

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendMessageBtn = document.getElementById('send-message');
        const clearChatBtn = document.getElementById('clear-chat');
        const saveChatBtn = document.getElementById('save-chat');
        const viewSavedChatsBtn = document.getElementById('view-saved-chats');
        const savedChatsModal = document.getElementById('saved-chats-modal');
        const savedChatsList = document.getElementById('saved-chats-list');
        const closeModalBtn = document.getElementById('close-modal');

        function loadChat() {
            const savedChat = localStorage.getItem('giftChat_current');
            if (savedChat) {
                chatContainer.innerHTML = savedChat;
            } else {
                addMessage('Welcome to Gift Genie! Describe the recipient or occasion to find the perfect gift.', 'assistant');
            }
        }

        function addMessage(message, role) {
            const div = document.createElement('div');
            div.className = `flex justify-${role === 'user' ? 'end' : 'start'} mb-4`;
            div.innerHTML = `
                <div class="chat-bubble ${role === 'user' ? 'bg-pink-500 text-white user-bubble' : 'bg-rose-50 text-rose-700 assistant-bubble'}">
                    <div class="flex items-center mb-2">
                        <i class="fas ${role === 'user' ? 'fa-user' : 'fa-gift'} mr-2"></i>
                        <span class="font-semibold">${role === 'user' ? 'You' : 'Gift Genie'}</span>
                    </div>
                    <div>${role === 'assistant' ? formatResponse(message) : message}</div>
                </div>
            `;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function formatResponse(text) {
            // Remove all markdown symbols
            text = text.replace(/[\*\#\`\~\_]/g, '');
            // Replace dollar signs with INR symbol
            text = text.replace(/\$/g, '₹');
            // Bold gift names and prices in Top Recommendations
            text = text.replace(/Top Recommendations:([\s\S]*?)(Where to Buy:|$)/gi, (match, p1) => {
                let formatted = p1.replace(/- ([^:]+): ₹?([\d\.]+)(.*?)(<br>|$)/g, '- <strong>$1</strong>: ₹<strong>$2</strong>$3$4');
                return `Top Recommendations:${formatted}`;
            });
            return text
                .replace(/Gift Overview:/gi, '<div class="section-title"><i class="fas fa-gift mr-2"></i>Gift Overview</div>')
                .replace(/Top Recommendations:/gi, '<div class="section-title"><i class="fas fa-star mr-2"></i>Top Recommendations</div>')
                .replace(/Where to Buy:/gi, '<div class="section-title"><i class="fas fa-shopping-cart mr-2"></i>Where to Buy</div>')
                .replace(/Personalization Tips:/gi, '<div class="section-title"><i class="fas fa-heart mr-2"></i>Personalization Tips</div>')
                .replace(/- (.*?)(<br>|$)/g, '<li class="ml-5">$1</li>')
                .replace(/<li/g, '<ul class="list-disc pl-5 space-y-1"><li')
                .replace(/<\/li>/g, '</li></ul>')
                .replace(/\n/g, '<br>');
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            userInput.value = '';

            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex justify-start mb-4';
            typingDiv.innerHTML = '<div class="chat-bubble bg-rose-50 text-rose-700 assistant-bubble"><i class="fas fa-ellipsis-h mr-2 animate-pulse"></i>Searching for gifts...</div>';
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `${SYSTEM_PROMPT}\n\n${message}` }] }]
                    })
                });

                const data = await response.json();
                chatContainer.removeChild(typingDiv);

                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I couldn’t find gift ideas. Please try again.';
                addMessage(reply, 'assistant');
            } catch (error) {
                console.error('Error:', error);
                chatContainer.removeChild(typingDiv);
                addMessage('Error retrieving gift ideas. Please try again.', 'assistant');
            }
        }

        function clearChat() {
            chatContainer.innerHTML = '';
            addMessage('Chat cleared. Ready to explore new gift ideas?', 'assistant');
            localStorage.removeItem('giftChat_current');
        }

        function saveChat() {
            const chatName = prompt('Enter a name for these gift ideas (e.g., "Dad’s Birthday"):');
            if (!chatName) {
                alert('Please provide a name to save the ideas.');
                return;
            }

            const timestamp = new Date().toISOString();
            const chatData = { name: chatName, content: chatContainer.innerHTML, timestamp };
            localStorage.setItem('giftChat_current', chatContainer.innerHTML);
            localStorage.setItem(`giftChat_${timestamp}`, JSON.stringify(chatData));
            alert(`Gift ideas saved as "${chatName}".`);
        }

        function viewSavedChats() {
            savedChatsList.innerHTML = '';
            const savedChats = Object.keys(localStorage)
                .filter(key => key.startsWith('giftChat_') && key !== 'giftChat_current')
                .map(key => ({ key, ...JSON.parse(localStorage.getItem(key)) }));

            if (savedChats.length === 0) {
                savedChatsList.innerHTML = '<p class="text-rose-600">No saved gift ideas yet.</p>';
            } else {
                savedChats.forEach(chat => {
                    const div = document.createElement('div');
                    div.className = 'saved-chat-item';
                    div.innerHTML = `
                        <span>${chat.name} (${new Date(chat.timestamp).toLocaleDateString()})</span>
                        <div>
                            <button class="view-btn text-pink-600 hover:text-pink-800 mr-2" data-key="${chat.key}"><i class="fas fa-eye"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-key="${chat.key}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    savedChatsList.appendChild(div);

                    div.querySelector('.view-btn').addEventListener('click', () => {
                        chatContainer.innerHTML = chat.content;
                        localStorage.setItem('giftChat_current', chat.content);
                        savedChatsModal.style.display = 'none';
                    });

                    div.querySelector('.delete-btn').addEventListener('click', () => {
                        if (confirm(`Are you sure you want to delete "${chat.name}"?`)) {
                            localStorage.removeItem(chat.key);
                            viewSavedChats();
                        }
                    });
                });
            }
            savedChatsModal.style.display = 'flex';
        }

        function quickStart(query) {
            userInput.value = query;
            sendMessage();
        }

        sendMessageBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
        clearChatBtn.addEventListener('click', clearChat);
        saveChatBtn.addEventListener('click', saveChat);
        viewSavedChatsBtn.addEventListener('click', viewSavedChats);
        closeModalBtn.addEventListener('click', () => savedChatsModal.style.display = 'none');
        savedChatsModal.addEventListener('click', (e) => {
            if (e.target === savedChatsModal) savedChatsModal.style.display = 'none';
        });

        loadChat();
    </script>
</body>
</html>
